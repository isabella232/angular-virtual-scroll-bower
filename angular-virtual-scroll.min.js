/* angular-virtual-scroll - v0.6.2 - 2015-08-21 */ !function(){"use strict";angular.module("sf.virtualScroll",[]).constant("sfVirtualScroll",{release:"0.6.2",version:"0.6.1-16-gfe8967b"})}(),function(){"use strict";var a=angular.module("sf.virtualScroll");a.filter("sublist",function(){return function(a,b,c){return a.slice(c,c+b)}})}(),function(){"use strict";var a=angular.module("sf.virtualScroll");a.directive("sfScroller",function(){function a(a){var b=a.match(/^(x|y)\s*(=|in)\s*(.+) to (.+)$/);if(!b)throw new Error("Expected sfScroller in form of '_axis_ in _lower_ to _upper_' but got '"+a+"'.");return{axis:b[1],lower:b[3],upper:b[4]}}var b=18;return function(c,d,e){var f=a(e.sfScroller),g=c.$eval(f.lower),h=c.$eval(f.upper),i="x"===f.axis;d.css({height:i?"1em":"100%",width:i?"100%":"1em","overflow-x":i?"scroll":"hidden","overflow-y":i?"hidden":"scroll",position:"absolute",top:i?"100%":0,right:0}).parent().css({position:"relative"});var j=angular.element("<div></div>");d.append(j),d.bind("scroll",function(){var a=d.prop("scrollTop");e.ngModel&&c.$apply(e.ngModel+" = "+a/b)}),c.$watch(f.lower,function(a){g=a,j.css("height",(h-g)*b+"px")}),c.$watch(f.upper,function(a){h=a,j.css("height",(h-g)*b+"px")}),c.$watch(e.ngModel,function(a){var c=a*b;d.prop("scrollTop")!==c&&d.prop("scrollTop".scrollTop)})}})}(),function(){"use strict";function a(b,c,d){return angular.isArray(b)?angular.forEach(b,function(b){return a(b,c,d)}):Math.max(c,Math.min(b,d))}var b=angular.module("sf.virtualScroll"),c=["TABLE","TBODY","THEAD","TR","TFOOT"],d=["TABLE","TBODY","THEAD","TR","TFOOT"],e=["TABLE","TBODY","THEAD","TR","TFOOT"];b.directive("sfVirtualRepeat",["$log","$rootElement",function(b,f){function g(a){var b=a.match(/^\s*([\$\w]+)\s+in\s+([\S\s]*)$/);if(!b)throw new Error("Expected sfVirtualRepeat in form of '_item_ in _collection_' but got '"+a+"'.");return{value:b[1],collection:b[2]}}function h(a,b){var c,d=a.tagName.toUpperCase();for(c=0;c<b.length;c++)if(b[c]===d)return!0;return!1}function i(a){var b,e,g=f[0];for(b=a.parent().parent()[0];b!==g&&1==b.nodeType;b=b.parentNode)if(!h(b,c)&&1==b.childElementCount&&!h(b.firstElementChild,d)){for(e=b.firstChild;e&&(3!=e.nodeType||!/\S/g.test(e.textContent));e=e.nextSibling);if(null==e)return{viewport:angular.element(b),content:angular.element(b.firstElementChild)}}throw new Error("No suitable viewport element")}function j(a){var b={overflow:"auto"},c=window.getComputedStyle?window.getComputedStyle(a[0]):a[0].currentStyle,d=c&&c.getPropertyValue("max-height"),e=c&&c.getPropertyValue("height");d&&"0px"!==d?b.maxHeight=d:e&&"0px"!==e?b.height=e:b.height=window.innerHeight,a.css(b)}function k(a){var b={margin:0,padding:0,border:0,"box-sizing":"border-box"};a.css(b)}function l(a){var c=window.getComputedStyle?window.getComputedStyle(a):a.currentStyle,d=c&&c.getPropertyValue("max-height"),e=c&&c.getPropertyValue("height");if(e&&"0px"!==e&&"auto"!==e)b.debug('Row height is "%s" from css height',e);else if(d&&"0px"!==d&&"none"!==d)e=d,b.debug('Row height is "%s" from css max-height',e);else{if(!a.clientHeight)throw new Error("Unable to compute height of row");e=a.clientHeight+"px",b.debug('Row height is "%s" from client height',e)}return angular.element(a).css("height",e),parseInt(e,10)}function m(c,d,f){function m(c,d,g){function m(a){var b={margin:"0"};h(a[0],e)||(b.display="block"),w&&(b.height=w+"px"),a.css(b)}function o(a,b,c){var d=c.$new(),e=c.$eval(b);return d[n.value]=e[a],d.$index=a,d.$first=0===a,d.$last=a===e.length-1,d.$middle=!(d.$first||d.$last),d.$watch(function(){e=c.$eval(b),d[n.value]=e[a]}),d}function p(a,b,c,d,e){var g,h,i,j=document.createDocumentFragment(),k=[];for(h=a;h!==b;h++)i=o(h,c,d),g=f(i,angular.noop),m(g),k.push(g),j.appendChild(g[0]);return e.after(j),k}function q(){var b=a(A.firstActive,A.firstVisible-A.lowWater,A.firstVisible-A.highWater),c=a(A.firstActive+A.active,A.firstVisible+A.visible+A.lowWater,A.firstVisible+A.visible+A.highWater);A.firstActive=a(b,0,A.total-A.visible-A.lowWater),A.active=Math.min(c,A.total)-A.firstActive}function r(a){if(w){var d=Math.abs(a.target.scrollTop-B);d>A.threshold*w&&(c.$apply(function(){A.firstVisible=Math.floor(a.target.scrollTop/w),A.visible=Math.ceil(z.viewport[0].clientHeight/w),b.debug("scroll to row %o",A.firstVisible);var c=a.target.scrollTop+a.target.clientHeight>=a.target.scrollHeight;q(),b.debug(" state is now %o",A),b.debug(" sticky = %o",c)}),B=a.target.scrollTop)}}function s(a){var b=a.$eval(n.collection);return b&&b.length!==A.total&&(A.total=b.length,q()),{start:A.firstActive,active:A.active,len:b?b.length:0}}function t(a,b){var c,d,e=Array.prototype[a];for(d=0;b>d;d++)c=e.call(v),c.scope().$destroy(),c.remove()}function u(a,c,e){var f,g=c.start+c.active;if(a===c)b.debug("initial listen"),f=p(a.start,g,n.collection,e,d),v=f,v.length&&(w=l(f[0][0]));else{var h=a.start+a.active,i=a.start>=c.start,j=i?a.start-c.start:c.start-a.start,k=h>=g?h-g:g-h,m=j<(i?c.active:a.active);if(b.debug("change by %o,%o rows %s",j,k,i?"forward":"backward"),m){if(i?(b.debug("need to remove from the top"),t("shift",j)):j&&(b.debug("need to add at the top"),f=p(a.start,c.start,n.collection,e,d),v=f.concat(v)),g>h)b.debug("need to remove from the bottom"),t("pop",g-h);else if(k){var o=v[v.length-1];b.debug("need to add to the bottom"),f=p(g,h,n.collection,e,o),v=v.concat(f)}}else b.debug("non-contiguous change"),t("pop",v.length),v=p(a.start,h,n.collection,e,d);!w&&v.length&&(w=l(v[0][0])),z.content.css({"padding-top":a.start*w+"px"})}z.content.css({height:a.len*w+"px"}),x&&y&&(z.viewport[0].scrollTop=z.viewport[0].clientHeight+z.viewport[0].scrollHeight)}var v=[],w=0,x=!1,y="sticky"in g,z=i(d),A="ngModel"in g?c.$eval(g.ngModel):{};A.firstActive=0,A.firstVisible=0,A.visible=0,A.active=0,A.total=0,A.lowWater=A.lowWater||100,A.highWater=A.highWater||300,A.threshold=A.threshold||1;var B=0;k(z.content),j(z.viewport),z.viewport.bind("scroll",r),c.$watch(s,u,!0)}var n=g(d.sfVirtualRepeat);return{post:m}}return{require:"?ngModel",transclude:"element",priority:1e3,terminal:!0,compile:m}}])}();